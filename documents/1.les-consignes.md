**Poste** : Senior Software Engineer - Website

**Dur√©e** : 3-4 heures maximum

**Format** : Code √† analyser + Code √† √©crire

---

## üìã Contexte

Pretto op√®re un site public sous Gatsby 4 avec les caract√©ristiques suivantes :

- **Contenu** : ~1500 pages WordPress (articles, pages institutionnelles)
- **Build time** : ~15 minutes (et augmente avec le contenu)
- **Preview** : N√©cessite un rebuild complet (15min d'attente pour l'√©diteur)
- **Data sources** : WordPress, API de taux immobiliers, Trustpilot
- **Trafic** : ~500k visiteurs/mois
- **SEO** : Critique pour l'acquisition (60% du trafic)

**Le probl√®me** : Les temps de build et l'absence de preview instantan√© ralentissent l'√©quipe contenu.

**La solution envisag√©e** : Migration vers un framework moderne avec build incr√©mental et preview.

---

## üìÑ Code Actuel (Gatsby)

Voici un extrait du fichier `gatsby-node.js` actuel :

```js
// gatsby-node.js
const fetch = require('node-fetch')

exports.sourceNodes = async ({ actions, createNodeId, createContentDigest }) => {
  const { createNode } = actions

  // Fetch market rates from external API
  const ratesResponse = await fetch('https://api.pretto.fr/rates', {
    headers: { 'Authorization': `Bearer ${process.env.RATES_API_KEY}` }
  })
  const rates = await ratesResponse.json()

  // Fetch Trustpilot reviews with pagination
  let allReviews = []
  let page = 1
  let hasMore = true

  while (hasMore) {
    const reviewsResponse = await fetch(`https://api.trustpilot.com/reviews?page=${page}`)
    const data = await reviewsResponse.json()
    allReviews = [...allReviews, ...[data.reviews](http://data.reviews)]
    hasMore = data.hasNextPage
    page++
  }

  // Create nodes for GraphQL
  rates.forEach(rate => {
    createNode({
      ...rate,
      id: createNodeId(`Rate-${[rate.date](http://rate.date)}`),
      internal: {
        type: 'Rate',
        contentDigest: createContentDigest(rate)
      }
    })
  })
}

exports.createPages = async ({ graphql, actions }) => {
  const { createPage } = actions

  // Fetch all WordPress posts
  const postsResult = await graphql(`
    query {
      allWpPost(limit: 1000) {
        nodes {
          id
          slug
          content
          date
          modified
          categories {
            nodes {
              name
              slug
            }
          }
          seo {
            title
            metaDesc
            canonical
          }
        }
      }
      allRate {
        nodes {
          rate
          date
        }
      }
    }
  `)

  if (postsResult.errors) {
    throw postsResult.errors
  }

  const posts = [postsResult.data](http://postsResult.data).allWpPost.nodes
  const rates = [postsResult.data](http://postsResult.data).allRate.nodes

  // Create a page for each post
  posts.forEach((post, index) => {
    const previousPost = index === 0 ? null : posts[index - 1]
    const nextPost = index === posts.length - 1 ? null : posts[index + 1]

    createPage({
      path: `/actualites/${post.slug}`,
      component: require.resolve('./src/templates/Post.js'),
      context: {
        id: [post.id](http://post.id),
        slug: post.slug,
        previousPost,
        nextPost,
        rates: rates.slice(0, 10), // Last 10 rates
      }
    })
  })

  // Create sitemap manually
  const fs = require('fs')
  const sitemap = `<?xml version="1.0" encoding="UTF-8"?>
    <urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9">
      ${[posts.map](http://posts.map)(post => `
        <url>
          <loc>https://www.pretto.fr/actualites/${post.slug}</loc>
          <lastmod>${post.modified}</lastmod>
        </url>
      `).join('')}
    </urlset>
  `
  fs.writeFileSync('./public/sitemap-posts.xml', sitemap)
}

exports.onPostBuild = async ({ graphql }) => {
  // Generate RSS feed
  const result = await graphql(`
    query {
      allWpPost(sort: {fields: date, order: DESC}, limit: 20) {
        nodes {
          title
          content
          date
          slug
        }
      }
    }
  `)

  const rss = `<?xml version="1.0" encoding="UTF-8"?>
    <rss version="2.0">
      <channel>
        <title>Pretto Blog</title>
        ${[result.data.allWpPost.nodes.map](http://result.data.allWpPost.nodes.map)(post => `
          <item>
            <title>${post.title}</title>
            <description>${post.content.substring(0, 200)}</description>
            <pubDate>${[post.date](http://post.date)}</pubDate>
            <link>https://www.pretto.fr/actualites/${post.slug}</link>
          </item>
        `).join('')}
      </channel>
    </rss>
  `

  require('fs').writeFileSync('./public/rss.xml', rss)
}
```

---

## üéØ Ta Mission

### Partie 1 : Analyse Critique (30-45min)

Identifie **3 probl√®mes principaux** dans ce code Gatsby et explique **pourquoi** ils posent probl√®me √† l'√©chelle (300+ pages, 500k visiteurs/mois).

**Livrable** : [`analyse.md`](http://analyse.md) (1 page maximum)

**Ce qu'on √©value** :

- Capacit√© √† identifier les **vrais goulots d'√©tranglement** (performance, scalabilit√©)
- Compr√©hension de l'impact **business** (temps de build = productivit√© √©quipe)
- Vision **production** (erreurs, fiabilit√©, r√©silience)

---

### Partie 2 : Solution Moderne (1h30-2h)

Impl√©mente la **m√™me fonctionnalit√©** (pages d'articles WordPress) avec un framework moderne de ton choix.

### Frameworks Accept√©s

Tu es **libre de choisir** la stack qui te semble la plus pertinente :

- **Next.js 14+** (App Router ou Pages Router)
- **Remix**
- **Astro**
- **Nuxt 3+**
- **SvelteKit**
- **Solution custom** (React SSR, Vite SSG, etc.)

**IMPORTANT** : Justifie ton choix de stack dans le README.

### Contraintes Fonctionnelles

Quel que soit le framework choisi, ta solution doit :

- ‚úÖ **G√©n√©ration statique** ou build incr√©mental (pas de SSR full pour chaque page)
- ‚úÖ **Metadata SEO** compl√®tes et optimis√©es
- ‚úÖ **R√©silience** : g√©rer le cas o√π WordPress est temporairement down
- ‚úÖ **TypeScript** propre et typ√©
- ‚úÖ **Performance** : optimis√© pour 500k visiteurs/mois

---

### Partie 3 : Audit SEO & Migration (45min-1h)

**Contexte** : Le SEO repr√©sente 60% de l'acquisition Pretto. Une migration mal faite = perte de trafic = perte de business.

### A. Identifie 3 probl√®mes SEO (20min)

Analyse le code Gatsby fourni et identifie **3 probl√®mes SEO critiques** parmi :

- Structured data (JSON-LD, [Schema.org](http://Schema.org))
- Open Graph incomplet
- Meta tags manquants (robots, dates, auteur)
- Balises s√©mantiques invalides
- Canonical URLs probl√©matiques
- Duplicate content risks

### B. Impl√©mente la solution SEO (25min)

Am√©liore ton code (Partie 2) pour r√©soudre ces probl√®mes SEO.

**Requirements minimums** :

- ‚úÖ **Structured data** (JSON-LD pour Article)
- ‚úÖ **Open Graph complet** (title, description, image, url, type)
- ‚úÖ **Meta robots** si n√©cessaire
- ‚úÖ **Dates** de publication/modification en format ISO
- ‚úÖ **Canonical URLs** dynamiques

---

### Partie 4 : Bonus - Preview WordPress (30min-1h)

**Optionnel** : Explique comment tu impl√©menteras le preview WordPress dans ta solution.

**Livrable** : [`preview-solution.md`](http://preview-solution.md) (description ou pseudo-code)

---

## üì¶ Comment Soumettre

Envoie-nous un **lien GitHub** (repo public ou priv√© avec acc√®s) contenant :

```
/solution
  [analyse.md](http://analyse.md)
  [audit-seo.md](http://audit-seo.md)
  /[framework-choisi]
  /lib
  [README.md](http://README.md)
  [preview-solution.md](http://preview-solution.md) (optionnel)
  package.json
```

[\*\*README.md](http://README.md) doit contenir\*\* :

- Choix de Stack (pourquoi ce framework ?)
- Strat√©gie de Rendering (SSG/ISR/SSR)
- Strat√©gie de Caching
- SEO Implementation
- Instructions d'installation

---

## ‚è±Ô∏è Timing Recommand√©

- **Analyse Gatsby** : 30-45min
- **Code Solution** : 1h30-2h
- **Audit SEO** : 45min-1h
- **Preview (bonus)** : 30min-1h
- **Total** : 3h-4h maximum

**Important** : On pr√©f√®re une **solution partielle mais propre** qu'une solution compl√®te mais b√¢cl√©e.

---

**Bonne chance !** üöÄ
